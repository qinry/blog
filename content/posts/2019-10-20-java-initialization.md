---
title: "初始化和清理"
date: 2019-10-20T09:28:44+08:00
tags: [ "java"]
---

## 构造器确保初始化

构造器确保初始化，名字与类名一致，允许重载，且是特殊的无返回值(与void不同)的方法。

在Java中，初始化与创建绑定在一起的

## 区别重载方法

通过不一样参数列表区分

整型常数值传入方法被当做int, char类型值如果没有匹配char参数方法，char会提升为int

## 默认构造器

就是指没有参数列表的构造器，如果未定义此方法，编译器会自动合成；若有定义，则不会自动创建

## 关键词this

只用在方法内部，表示当前对象的引用；如果在方法内调用同个类的另个方法，就不必使用this，直接调用即可。

### 在构造器中调用构造器

注：尽管可以this调用一个构造器，但却不能调用两个。此外，必须将构造器调用置于最起始处，否则compiler报错

## static方法

static方法一般不能调用非static方法，反过来却可以。

注：Java禁止全局方法，但在类中置入static方法可以访问其他static方法和static域

## 清理 -- 终结处理和垃圾回收

要知道：

1. 对象可能不被垃圾回收
2. 垃圾回收并等于“析构”
3. 垃圾回收（回收不使用内存）只与内存有关

### finalize()方法

* finalize()不该作为通用清理方法，针对特殊需求，比如通过new创建对象以外的方式分配空间，使用非Java代码，可用finalize()用本地方法调用
* 验证对象终结条件

#### System.gc() 

强制进行终结

注：Java不允许创建局部对象，必须使用**new**创建。“终结”和“垃圾回收”不保证发生，这是考虑到垃圾回收器自身的开销，当JVM面临内存耗尽，才很可能执行回收对象，恢复内存

#### 垃圾回收器 （边回收空间，边重新排列对象，但不保证一定发生）

简单说说它的工作机制（详细见《深入理解Java虚拟机》，周志明著），采用自适应技术，会有内存页面调度（将页面移进移出硬盘，且显著影响性能）

* 停止-复制 ：先暂停程序，将存活的对象从旧堆复制到新堆，并且复制后的对象排列紧凑，未被复制的对象都是垃圾。复制的对象所绑定的引用要修正，以指向复制后的新对象。特点：维护空间比实际大，效率低。

* 标记-清扫 ： 也会导致程序暂停。对存活的对象进行标记，所有对象标记完再清理未标记的，堆空间不连续，对象可能会重新整理。特点：针对少垃圾甚至无垃圾的情况效率才高，一般情况下效率低。

* 分代 ： 块有对应的代数(generation count)，它是堆上分配较大的内存。其代数记录对象是否还存活。如果块在某处被引用，其代数增加。特点：对大量临时对象处理有帮助，定期进行完整清理--大对象不被复制（代数增加），内含小对象被复制并整理

* 附加技术提速（特别是hotspot），即时编译器(Just-In Time, JIT)

类文件中字节码装载内存，有两方案：

* 全部代码编译，缺点就是费时，可执行代码加长，导致页面调度，影响性能
* 惰性评估（必要时才编译）

## 成员初始化

* 指定初始化
* 构造器初始化（给编程带来更大的灵活性） 自动初始化发生在调用构造器之前

注：static可用于域，不可用于局部变量
初始化顺序：先静态后非静态对象

对象的创建过程：

1. Java解释器查找类路径，指定(.class)文件
2. 载入(.class)文件，静态初始化只在class对象首次加载时进行1次
3. 为对象在堆上分配存储空间，所有类内基本成员设为默认值， 对象设为null
4. 执行指定初始化，在执行构造器

### 静态子句和实例初始化

静态子句，当首次生成类的一个对象或首次访问类中static域，static子句执行一次
子句形如:

```java
static {
 /* ... */
}
```

非静态实例初始化像静态子句，只是左花括号前无关键字 **static**

## 数组初始化

### 1.在定义处初始化的特殊形式

#### (1).基本数据类型

```java
int[] a = { 1, 2, 3, 4};
或 int a[] = { 1, 2, 3, 4 }
```

#### (2).引用数据类型

```java
Integer[] b = new Integer[]{
    new Integer(1),
    new Integer(2),
    3,
};
```

### 2.可以不在定义除初始化的形式

```java
int[] a;
Random rand = new Random(47);
a = new int[rand.nextInt(20)];
for (int i = 0; i < a.length; i++>)
    a[i] = rand.nextInt(100); //  还要把对象赋值给数组元素才算完成初始化
``` 



## 可变参数列表

形如:

```java
returnType methodName(Object... args) { /* */ }
```

编译器会把参数列表转变为Object数组，如果参数列表像Integer数组这样的非Object数组要转型为一个Object数组

## 枚举类型

与switch 语句配合相当合适
如何定义枚举类型

```java
public enum Color {
    // 整型常量集
    RED, GREEN, BLUE
};
```

如何使用

```java
Color red = Color.RED;
```

有类静态方法 **static values()** 得到enum常量构成的数组
普通成员方法 **ordinal()** 得到enum常量声明的顺序(顺序是从0开始的)
red.ordinal() 结果是 0
